<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Items - Gubevu Electrical</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="form-screen">
        <div class="form-header">
            <button class="back-btn" onclick="goBack()">‚Üê Back</button>
            <h2>Add Line Items</h2>
            <div style="width: 60px;"></div>
        </div>
        
        <div class="form-content">
            <div id="current-item-form" class="item-form">
                <div class="form-group">
                    <label for="item-desc">Description</label>
                    <input type="text" id="item-desc" placeholder="Enter item description">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-amount">Amount (R)</label>
                        <input type="number" id="item-amount" placeholder="0.00" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="item-qty">Quantity</label>
                        <input type="number" id="item-qty" value="1" min="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="item-activity">Activity</label>
                    <select id="item-activity">
                        <option>Material</option>
                        <option>Labour</option>
                        <option>Service</option>
                    </select>
                </div>
                
                <button class="btn-add" onclick="addItem()">+ Add This Item</button>
            </div>
            
            <div id="items-list" class="items-list">
                <h3>Added Items</h3>
                <!-- Items will appear here -->
                <div class="no-items">No items added yet</div>
            </div>
            
            <div class="form-actions">
                <button class="btn-secondary" onclick="saveDraft()">üíæ Save as Draft</button>
                <button class="btn-preview" onclick="preview()">üìÑ Preview Invoice</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Check login
        if (!localStorage.getItem('currentUser')) {
            window.location.href = 'index.html';
        }
        
        let items = JSON.parse(localStorage.getItem('currentItems') || '[]');
        
        function goBack() {
            window.location.href = 'create-invoice.html';
        }
        
        function addItem() {
            const desc = document.getElementById('item-desc').value;
            const amount = parseFloat(document.getElementById('item-amount').value);
            const qty = parseInt(document.getElementById('item-qty').value);
            const activity = document.getElementById('item-activity').value;
            
            if (!desc || !amount) {
                alert('Please enter description and amount');
                return;
            }
            
            const item = {
                id: Date.now(),
                description: desc,
                amount: amount,
                quantity: qty || 1,
                activity: activity,
                total: amount * (qty || 1)
            };
            
            items.push(item);
            localStorage.setItem('currentItems', JSON.stringify(items));
            renderItems();
            
            // Clear form
            document.getElementById('item-desc').value = '';
            document.getElementById('item-amount').value = '';
            document.getElementById('item-qty').value = '1';
        }
        
        function deleteItem(id) {
            items = items.filter(item => item.id !== id);
            localStorage.setItem('currentItems', JSON.stringify(items));
            renderItems();
        }
        
        function renderItems() {
            const container = document.getElementById('items-list');
            const noItems = container.querySelector('.no-items');
            
            if (items.length === 0) {
                noItems.style.display = 'block';
                return;
            }
            
            noItems.style.display = 'none';
            
            let html = '<h3>Added Items (' + items.length + ')</h3>';
            items.forEach(item => {
                html += `
                <div class="item-card">
                    <div class="item-info">
                        <strong>${item.description}</strong>
                        <div class="item-details">
                            ${item.activity} ‚Ä¢ R ${item.amount.toFixed(2)} √ó ${item.quantity}
                        </div>
                    </div>
                    <div class="item-total">
                        R ${item.total.toFixed(2)}
                        <button class="btn-delete" onclick="deleteItem(${item.id})">√ó</button>
                    </div>
                </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function saveDraft() {
            if (items.length === 0) {
                alert('Add at least one item before saving');
                return;
            }
            
            const client = JSON.parse(localStorage.getItem('currentClient') || '{}');
            const draft = {
                id: Date.now(),
                type: 'invoice',
                number: 'DRAFT-' + Date.now().toString().slice(-6),
                client: client,
                items: items,
                date: new Date().toLocaleDateString('en-GB'),
                status: 'draft',
                createdBy: localStorage.getItem('currentUser')
            };
            
            // Save to drafts
            let drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
            drafts.push(draft);
            localStorage.setItem('drafts', JSON.stringify(drafts));
            
            alert('Draft saved!');
            window.location.href = 'dashboard.html';
        }
        
        function preview() {
            if (items.length === 0) {
                alert('Add at least one item before previewing');
                return;
            }
            
            window.location.href = 'preview.html';
        }
        
        // Render items on load
        renderItems();
    </script>
</body>
</html>
