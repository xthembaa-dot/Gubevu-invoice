<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Template</title>
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        /* Print styles for the invoice */
        @media print {
            body * {
                visibility: hidden;
            }
            .invoice-container, .invoice-container * {
                visibility: visible;
            }
            .invoice-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container" id="invoice-template">
        <!-- Company Header -->
        <div class="invoice-header">
            <div class="company-info">
                <div class="logo-container">
                    <img src="../assets/logo.png" alt="Gubevu Electrical" class="company-logo">
                </div>
                <div>
                    <h1>Gubevu Electrical</h1>
                    <p class="company-address">123 Main Street, City, 12345</p>
                    <p class="company-contact">Phone: (012) 345-6789 | Email: info@gubevu.co.za</p>
                    <p class="company-vat">VAT No: 4567891234</p>
                </div>
            </div>
            
            <div class="invoice-title">
                <h2 class="invoice-type" id="invoice-type">INVOICE</h2>
                <div class="invoice-meta">
                    <p>Invoice #: <span id="invoice-number">INV-001</span></p>
                    <p>Date: <span id="invoice-date">15 Jan 2024</span></p>
                    <p>Due Date: <span id="due-date">30 Jan 2024</span></p>
                    <p>Status: <span id="invoice-status" class="status-draft">Draft</span></p>
                </div>
            </div>
        </div>

        <!-- Client & Company Info -->
        <div class="invoice-parties">
            <div class="bill-to">
                <h3>Bill To:</h3>
                <div class="client-details">
                    <p id="client-name">Client Name</p>
                    <p id="client-address">Client Address</p>
                    <p id="client-phone">Phone: (000) 000-0000</p>
                    <p id="client-email">Email: client@email.com</p>
                </div>
            </div>
            
            <div class="company-details">
                <h3>From:</h3>
                <div>
                    <p>Gubevu Electrical</p>
                    <p>123 Main Street</p>
                    <p>City, 12345</p>
                    <p>Phone: (012) 345-6789</p>
                    <p>Email: info@gubevu.co.za</p>
                    <p>VAT No: 4567891234</p>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <div class="invoice-table">
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>VAT (15%)</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="items-table-body">
                    <!-- Items will be inserted here -->
                </tbody>
            </table>
        </div>

        <!-- Totals -->
        <div class="invoice-totals">
            <div class="totals-left">
                <p>Notes:</p>
                <div class="notes" id="invoice-notes">
                    <p>Thank you for your business!</p>
                    <p>Payment due within 30 days.</p>
                </div>
            </div>
            <div class="totals-right">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">R 0.00</span>
                </div>
                <div class="total-row">
                    <span>VAT (15%):</span>
                    <span id="vat-amount">R 0.00</span>
                </div>
                <div class="total-row grand-total">
                    <span>TOTAL:</span>
                    <span id="total-amount">R 0.00</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <p>Banking Details: Gubevu Electrical | Bank: Standard Bank | Account: 123456789 | Branch: 123456</p>
            <p>Please quote invoice number when making payment</p>
            <p class="footer-note">Invoice generated by Iciko Systems</p>
        </div>

        <!-- Mobile Print Button -->
        <div class="no-print mobile-print-actions">
            <button onclick="window.print()" class="print-btn">Print Invoice</button>
            <button onclick="downloadPDF()" class="pdf-btn">Download PDF</button>
        </div>
    </div>

    <script src="shared-data.js"></script>
    <script>
        // Function to load invoice data into template
        function loadInvoiceData(invoiceData) {
            if (!invoiceData) return;
            
            // Set basic info
            document.getElementById('invoice-type').textContent = invoiceData.type === 'quote' ? 'QUOTATION' : 'INVOICE';
            document.getElementById('invoice-number').textContent = invoiceData.id;
            document.getElementById('invoice-date').textContent = invoiceData.date;
            document.getElementById('due-date').textContent = invoiceData.dueDate || invoiceData.date;
            document.getElementById('invoice-status').textContent = invoiceData.status;
            document.getElementById('invoice-status').className = `status-${invoiceData.status}`;
            
            // Set client info
            document.getElementById('client-name').textContent = invoiceData.client.name || 'Not Provided';
            document.getElementById('client-address').textContent = invoiceData.client.address || '';
            document.getElementById('client-phone').textContent = invoiceData.client.phone ? `Phone: ${invoiceData.client.phone}` : '';
            document.getElementById('client-email').textContent = invoiceData.client.email ? `Email: ${invoiceData.client.email}` : '';
            
            // Set items
            const tbody = document.getElementById('items-table-body');
            tbody.innerHTML = '';
            
            if (invoiceData.items && invoiceData.items.length > 0) {
                invoiceData.items.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.description}</td>
                        <td>${item.quantity}</td>
                        <td>R ${item.price.toFixed(2)}</td>
                        <td>R ${item.vat.toFixed(2)}</td>
                        <td>R ${item.total.toFixed(2)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // Set totals
            if (invoiceData.totals) {
                document.getElementById('subtotal').textContent = `R ${invoiceData.totals.subtotal.toFixed(2)}`;
                document.getElementById('vat-amount').textContent = `R ${invoiceData.totals.vat.toFixed(2)}`;
                document.getElementById('total-amount').textContent = `R ${invoiceData.totals.total.toFixed(2)}`;
            }
            
            // Set notes if any
            if (invoiceData.notes) {
                document.getElementById('invoice-notes').innerHTML = invoiceData.notes.replace(/\n/g, '<br>');
            }
        }
        
        // Check if we have invoice ID in URL
        const urlParams = new URLSearchParams(window.location.search);
        const invoiceId = urlParams.get('id');
        
        if (invoiceId) {
            const invoice = loadInvoice(invoiceId);
            if (invoice) {
                loadInvoiceData(invoice);
            }
        }
        
        // PDF download function (will be implemented later)
        function downloadPDF() {
            alert('PDF generation will be implemented in the next phase');
            // Will use jsPDF library
        }
    </script>
</body>
</html>
